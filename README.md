# grapl-analyzer-deployer
A deployment service that plugs into Grapl.

If you have set up [Grapl](https://github.com/insanitybit/grapl) you can use this plugin to automate
the deployment of your analyzers from a git repository.

As an example, [insanitybit/grapl-analyzers](https://github.com/insanitybit/grapl-analyzers/blob/master/README.md) is set up to use this webhook.

### Deploy
To get started you'll need to install [npm](https://www.npmjs.com/), [typescript](https://www.typescriptlang.org/index.html#download-links), and the [aws-cdk](https://github.com/awslabs/aws-cdk#getting-started).

Clone the repo:
`git clone git@github.com:insanitybit/grapl-analyzer-deployer.git`

Change directories into the `/grapl-analyzer-deployer/analyzer-deployer-cdk/` folder.

You'll need to fill out a .env file with the following and place is it in the `analyzer-deployer-cdk` folder.

Variables:
`GITHUB_SHARED_SECRET`
The secret used by the server to authenticate the client. Consider:
`ruby -rsecurerandom -e 'puts SecureRandom.hex(20)'`

`GITHUB_ACCESS_TOKEN`
This is a "[Personal Access Token](https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line)" generated by github.

`BUCKET_PREFIX`
This is the unique bucket prefix for your Grapl deployment.

Example:
```
GITHUB_SHARED_SECRET="b21b7bad3a6d35623a4d1fc9d588352294af4eb4"
GITHUB_ACCESS_TOKEN="31f9a214d7509a9c0ae2744df537d39de06422ec"
BUCKET_PREFIX="exampleco"
```
(You may need to build dependencies with `npm i`)

Run `./deploy.sh`

### Setting up the Webhook
https://developer.github.com/webhooks/creating/

Set the webhook url to the API Gateway created by the cdk deployment, set the secret to the value of GITHUB_SHARED_SECRET.
